<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>アドベンチャーゲーム</title>
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>

    <div id="gamewindow">
      <img src="image/chara/6.png" id="chara">
      <div id="message">
      </div>
    </div>

    <script src="js/scenario.js"></script>
    <script>
      let BGM = null;
      let current = 0;

      const gamewindow = document.querySelector('#gamewindow');
      const message = document.querySelector('#message');
      message.addEventListener('click', () => {
        if( current === SCENARIO.length ) {
          setSerif('おしまい');
          return(true);
        }

        const command = SCENARIO[current][INDEX_COMMAND];
        const value   = SCENARIO[current][INDEX_VALUE];

        switch( command ){
          case 'SERIF':
            setSerif(value);
            break;
          case 'BG-IMAGE':
            setBackgroundImage(value);
            break;
          case 'BGM-PLAY':
            playBGM(value);
            break;
        }

        current++;
      });

      /**
       * セリフを表示
       */
      function setSerif(text, html=false){
        if( html ){
          message.innerHTML = text;
        }
        else{
          message.textContent = text;
        }
      }

      /**
       * 背景画像を設定
       */
      function setBackgroundImage(url){
        gamewindow.style.backgroundImage = `url(image/back/${url})`;
      }

      /**
       * BGMを再生
       */
      function playBGM(url, volume=0.2){
        if( BGM !== null ){
          stopBGM();
        }
        const audio = new Audio(`audio/bgm/${url}`);
        BGM = audio;
        BGM.volume = volume;
        BGM.play();
      }

      /**
       * BGMを停止
       */
      function stopBGM(){
        if( BGM !== null ){
          BGM.pause();
        }
      }
    </script>
  </body>
</html>